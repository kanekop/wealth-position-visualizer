# 開発ドキュメント - 富の位置可視化アプリ

最終更新: 2024年5月27日

## 📊 現在の開発状況

### ✅ 実装済み機能

#### 1. 基本UI構造
- **ヘッダー**: アプリタイトル、Aboutボタン、言語切り替えボタン
- **入力フォーム**: 年収・総資産の入力フィールド
- **結果表示**: 日本・世界での位置表示（**実データによる計算実装済み**）
- **レスポンシブデザイン**: Tailwind CSSによるモバイル対応

#### 2. バイリンガル対応
- **実装方式**: React Context APIを使用
- **対応言語**: 日本語・英語
- **切り替えUI**: ヘッダー右上のトグルボタン
- **ファイル構成**:
  ```
  src/contexts/LanguageContext.jsx  # 言語管理とテキストデータ
  src/components/LanguageToggle.jsx # 切り替えボタンコンポーネント
  ```

#### 3. 計算ロジック（2024年5月27日実装）
- **パレート分布・対数正規分布の実装**: ✅ 完了
- **富裕度スコアの計算**: ✅ 完了（年収×10年 + 総資産）
- **順位・占有率の算出**: ✅ 完了
- **実装ファイル**:
  ```
  src/data/constants.js      # 統計データ定数（日本・世界）
  src/utils/distributions.js # 分布計算関数
  src/utils/calculations.js  # メイン計算ロジック
  ```

#### 4. 技術基盤
- **フレームワーク**: React (Vite)
- **スタイリング**: Tailwind CSS v3（v4からダウングレード済み）
- **アイコン**: lucide-react
- **数値フォーマット**: numeral（インストール済み、未使用）
- **グラフ**: Chart.js（インストール済み、未使用）

### 🔄 実装済みだが改善が必要な機能

#### 1. 計算精度の向上
- **現状**: 基本的な混合分布モデルで計算
- **課題**: 
  - パラメータの精緻化が必要
  - 実際の統計データとの照合が必要
  - 年収1000万円、資産1億円での結果検証が必要
  - 年収200万円、資産50万円での結果検証が必要

#### 2. 入力値の処理
- **現状**: parseNumberInput関数でカンマ・全角対応
- **課題**: より堅牢なバリデーションが必要

### ❌ 未実装機能

#### 1. ビジュアライゼーション
- Chart.jsを使った分布グラフ
- 位置の視覚的表示
- アニメーション効果

#### 2. UX改善
- 数値のカンマ区切り自動表示（numeralライブラリ活用）
- 入力中のリアルタイムフォーマット
- ローディング状態の表示

#### 3. About機能
- 計算方法の説明モーダル
- データソースの明示
- 免責事項の詳細

#### 4. 結果の共有機能
- SNSシェア
- 結果画像の生成
- URLでの結果共有

## 🎯 次回の作業計画

### 最優先: 計算精度の検証と改善（Phase 1.5）

#### 1. パラメータの調整
**対象ファイル**: `src/data/constants.js`

現在の課題：
- 年収1000万円、資産1億円で日本の上位15.3%は低すぎる可能性
- 実際は上位3-5%程度が妥当と思われる

調整案：
```javascript
// 対数正規分布パラメータの調整
logNormalMu: 15.2,    // → 15.8に調整？
logNormalSigma: 0.8,  // → 0.6に調整？

// 閾値の調整
top10PercentThreshold: 8000000,  // → 再検証が必要
```

#### 2. デバッグツールの追加
- 計算過程の可視化機能
- パラメータ調整用の管理画面（開発時のみ）
- 実際の統計データとの比較表示

### Phase 2: ビジュアライゼーション（2-3日）

#### 2.1 分布グラフコンポーネント
**ファイル**: `src/components/DistributionChart.jsx`
- 正規分布曲線の描画
- ユーザーの位置をマーカーで表示
- 日本/世界の切り替え

#### 2.2 結果表示の改善
**ファイル**: `src/components/ResultDisplay.jsx`
- 現在のインライン実装を分離
- より視覚的にインパクトのある表示
- アニメーション追加

### Phase 3: UX/UI改善（2日）

#### 3.1 計算結果の表示の改善
- 年収の順位およびパーセンタイルと資産の順位およびパーセンタイルをわけて表示させたい。

#### 3.2 入力フォームの改善
**ファイル**: `src/components/InputForm.jsx`
- numeralを使った自動フォーマット
- リアルタイムバリデーション
- ツールチップ

#### 3.3 Aboutモーダル実装
**ファイル**: `src/components/AboutModal.jsx`
- 計算方法の説明
- データソース明記
- 制限事項

## 📁 現在のファイル構造

```
src/
├── components/
│   └── LanguageToggle.jsx    # 実装済み
├── contexts/
│   └── LanguageContext.jsx   # 実装済み
├── utils/
│   ├── calculations.js       # 実装済み
│   └── distributions.js      # 実装済み
├── data/
│   └── constants.js          # 実装済み
├── App.jsx                   # 実装済み（バイリンガル対応）
├── index.jsx
└── index.css
```

## 🐛 既知の問題と対応状況

### 解決済み
1. **Tailwind CSS v4の互換性問題**
   - v3.4.0にダウングレードして解決
   
2. **計算ロジックの未実装**
   - 2024年5月27日に実装完了

### 未解決
1. **言語切り替え時の地域名**
   - 結果表示の「日本」「世界」がハードコード
   - 翻訳オブジェクトに追加が必要

2. **計算精度**
   - パラメータの精緻化が必要
   - 実データとの照合が必要

3. **モバイル表示**
   - 結果表示部分のレイアウト調整が必要

## 💡 今後の展開アイデア

### 短期（1-2週間）
1. **計算精度の向上**
   - 最新の統計データを反映
   - パラメータの微調整
   
2. **基本的なグラフ表示**
   - Chart.jsで分布曲線を表示

### 中期（1ヶ月）
1. **Preference画面**
   - 為替レート調整
   - 計算パラメータのカスタマイズ
   
2. **詳細分析機能**
   - 年齢別分析
   - 地域別分析

### 長期（3ヶ月以降）
1. **データの自動更新**
   - APIからの統計データ取得
   - 四半期ごとの更新
   
2. **多言語展開**
   - 中国語対応
   - その他の言語

## 📝 開発メモ

### 2024年5月27日の進捗
- ✅ プロジェクト開始
- ✅ 基本UI実装
- ✅ バイリンガル対応実装
- ✅ 計算ロジック実装（パレート分布・対数正規分布）
- ✅ 実データによる計算結果表示
- ⚠️ 計算精度は要調整

### 技術的な決定事項
- **富裕度スコア計算**: 年収×10年 + 総資産
- **為替レート**: 1USD = 150円（将来的に調整可能に）
- **分布モデル**: 混合分布（閾値以下は対数正規、以上はパレート）

### 次回作業時の注意点
1. App.jsxが正しいバージョンか確認（バイリンガル対応版）
2. Tailwind CSSのバージョンが3.x系か確認
3. 計算結果のデバッグログを活用

---

**注意**: このドキュメントは開発者間の情報共有用です。実装時は必ず更新してください。